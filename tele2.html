<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newtonian Telescope VR</title>
    
    <!-- META QUEST COMPATIBLE A-FRAME -->
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.4.0/dist/aframe-master.min.js"></script>
    
    <style>
        /* REMOVE ALL MARGINS */
        * { margin: 0; padding: 0; border: 0; }
        body, html { width: 100vw; height: 100vh; overflow: hidden; background: #000; }
        
        /* SIMPLE LOADING - QUEST FRIENDLY */
        #loading {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            color: #0ff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: sans-serif;
            z-index: 10000;
        }
        
        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid #0ff;
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* HIDDEN */
        .hidden { opacity: 0; pointer-events: none; }
        
        /* SIMPLE CONTROLS */
        .controls {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        
        .btn {
            background: rgba(0, 100, 255, 0.7);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        /* QUEST SAFE MESSAGE */
        .message {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 90%;
            text-align: center;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- SIMPLE LOADING -->
    <div id="loading">
        <div style="text-align: center;">
            <div class="loader"></div>
            <p style="margin-top: 10px;">Loading Telescope VR...</p>
        </div>
    </div>
    
    <!-- STATUS MESSAGE -->
    <div class="message hidden" id="message">Click telescope parts!</div>
    
    <!-- SIMPLE CONTROLS -->
    <div class="controls hidden" id="controls">
        <button class="btn" onclick="speak('This is a Newtonian telescope')">Speak</button>
        <button class="btn" onclick="resetView()">Reset</button>
        <button class="btn" onclick="showMessage('Click the glowing parts!')">Help</button>
    </div>
    
    <!-- META QUEST COMPATIBLE VR SCENE -->
    <a-scene 
        vr-mode-ui="enabled: true"
        xr-mode-ui="XRMode: vr"
        background="color: #000033"
        loading-screen="enabled: false"
        embedded
        renderer="antialias: true; precision: medium"
    >
        
        <!-- CAMERA FOR QUEST -->
        <a-entity position="0 1.6 3" id="camera-rig">
            <a-camera id="camera" look-controls="enabled: true" wasd-controls="enabled: false">
                <!-- SIMPLE CURSOR FOR QUEST -->
                <a-cursor 
                    fuse="true" 
                    fuse-timeout="500"
                    raycaster="objects: .clickable"
                    material="color: #0F0; shader: flat"
                ></a-cursor>
            </a-camera>
        </a-entity>
        
        <!-- SIMPLE TELESCOPE - QUEST OPTIMIZED -->
        <a-entity id="telescope" position="0 1 -2">
            <!-- BASE -->
            <a-cylinder id="base" class="clickable"
                radius="0.4" height="0.1" color="#8B4513"
                position="0 0 0">
            </a-cylinder>
            
            <!-- MOUNT -->
            <a-cylinder id="mount" class="clickable"
                radius="0.1" height="0.8" color="#555"
                position="0 0.5 0">
            </a-cylinder>
            
            <!-- TUBE -->
            <a-cylinder id="tube" class="clickable"
                radius="0.25" height="1.2" color="#333"
                position="0 1.2 0">
            </a-cylinder>
            
            <!-- PRIMARY MIRROR - WITH GLOW -->
            <a-cylinder id="primary" class="clickable mirror"
                radius="0.2" height="0.05" color="#0ff"
                emissive="#0ff" emissive-intensity="0.3"
                position="0 0.6 0.26" rotation="90 0 0">
            </a-cylinder>
            
            <!-- SECONDARY MIRROR -->
            <a-box id="secondary" class="clickable mirror"
                width="0.1" height="0.001" depth="0.1" color="#0ff"
                emissive="#0ff" emissive-intensity="0.2"
                position="0 1.4 0" rotation="45 0 0">
            </a-box>
            
            <!-- EYEPIECE -->
            <a-cylinder id="eyepiece" class="clickable"
                radius="0.04" height="0.15" color="#222"
                position="0.3 1.4 0" rotation="0 0 90">
            </a-cylinder>
        </a-entity>
        
        <!-- FLOOR -->
        <a-circle 
            position="0 0 0" 
            rotation="-90 0 0" 
            radius="10" 
            color="#112233"
        ></a-circle>
        
        <!-- SIMPLE SKY - QUEST SAFE -->
        <a-sky color="#000022"></a-sky>
        
        <!-- LIGHTS -->
        <a-light type="ambient" color="#fff" intensity="0.6"></a-light>
        <a-light type="directional" color="#fff" intensity="0.5" position="1 3 2"></a-light>
        
    </a-scene>

    <script>
        // =========== META QUEST COMPATIBLE CODE ===========
        console.log("META QUEST TELESCOPE VR STARTING...");
        
        // 1. WAIT FOR A-FRAME
        document.querySelector('a-scene').addEventListener('loaded', function() {
            console.log("âœ… A-Frame loaded on Quest");
            initQuestApp();
        });
        
        function initQuestApp() {
            // Hide loading after 1 second
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('controls').classList.remove('hidden');
                showMessage("Look at telescope parts and click!");
                
                // Auto welcome message
                setTimeout(() => {
                    speak("Welcome to Newtonian Telescope VR. Look at the glowing parts and click them.");
                }, 500);
                
                setupTelescope();
            }, 1000);
        }
        
        function setupTelescope() {
            // Make parts interactive
            const parts = ['base', 'mount', 'tube', 'primary', 'secondary', 'eyepiece'];
            
            parts.forEach(partId => {
                const part = document.getElementById(partId);
                if (part) {
                    // Click event for Quest
                    part.addEventListener('click', function() {
                        console.log("Clicked:", partId);
                        
                        // Visual feedback
                        highlightPart(this);
                        
                        // Speak about part
                        explainPart(partId);
                        
                        // Move camera closer
                        moveCameraToPart(partId);
                    });
                    
                    // Hover effect
                    part.addEventListener('mouseenter', function() {
                        this.setAttribute('scale', '1.05 1.05 1.05');
                    });
                    
                    part.addEventListener('mouseleave', function() {
                        this.setAttribute('scale', '1 1 1');
                    });
                }
            });
        }
        
        function highlightPart(element) {
            // Store original color
            const original = element.getAttribute('material').color;
            
            // Flash yellow
            element.setAttribute('material', 'color', '#ff0');
            element.setAttribute('material', 'emissive', '#ff0');
            element.setAttribute('material', 'emissive-intensity', '0.5');
            
            // Reset after 1.5 seconds
            setTimeout(() => {
                if (original) {
                    element.setAttribute('material', 'color', original);
                    element.setAttribute('material', 'emissive', original);
                    element.setAttribute('material', 'emissive-intensity', '0.3');
                }
            }, 1500);
        }
        
        function moveCameraToPart(partId) {
            const camera = document.getElementById('camera-rig');
            const part = document.getElementById(partId);
            
            if (!camera || !part) return;
            
            // Get part position
            const pos = part.object3D.position;
            
            // Move camera closer (but not too close)
            const newX = pos.x;
            const newY = pos.y + 0.2;
            const newZ = pos.z + 0.8;
            
            // Animate camera
            camera.setAttribute('animation', {
                property: 'position',
                to: `${newX} ${newY} ${newZ}`,
                dur: 800,
                easing: 'easeInOutQuad'
            });
        }
        
        function resetView() {
            const camera = document.getElementById('camera-rig');
            if (camera) {
                camera.setAttribute('animation', {
                    property: 'position',
                    to: '0 1.6 3',
                    dur: 800,
                    easing: 'easeInOutQuad'
                });
                speak("View reset");
            }
        }
        
        function explainPart(partId) {
            const explanations = {
                base: "This is the telescope base. It provides stability so the telescope doesn't shake.",
                mount: "This is the mount. It allows the telescope to move up, down, and sideways to track stars.",
                tube: "This is the optical tube. It holds the mirrors and blocks stray light.",
                primary: "This is the primary mirror. It collects light from stars and galaxies and focuses it.",
                secondary: "This is the secondary mirror. It redirects light to the eyepiece at the side.",
                eyepiece: "This is the eyepiece. You look here to see the magnified image of space."
            };
            
            const text = explanations[partId] || "This is part of the telescope.";
            speak(text);
            showMessage(text);
        }
        
        // =========== META QUEST VOICE SYSTEM ===========
        function speak(text) {
            console.log("ðŸ”Š Speaking:", text);
            
            // Show message
            showMessage(text);
            
            // Use Web Speech API (works on Quest browser)
            if ('speechSynthesis' in window) {
                // Cancel any current speech
                window.speechSynthesis.cancel();
                
                // Create utterance
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Quest-compatible settings
                utterance.rate = 0.9; // Slightly slower for clarity
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                // Get voices
                const voices = speechSynthesis.getVoices();
                
                // Try to find a good voice
                if (voices.length > 0) {
                    // Prefer English voices
                    const englishVoice = voices.find(v => v.lang.startsWith('en'));
                    if (englishVoice) {
                        utterance.voice = englishVoice;
                    }
                }
                
                // Speak
                window.speechSynthesis.speak(utterance);
                
                // Visual feedback
                document.getElementById('message').style.color = '#ff0';
                setTimeout(() => {
                    document.getElementById('message').style.color = '#0f0';
                }, 1000);
                
            } else {
                console.warn("Speech synthesis not available");
                // Fallback: just show message
            }
        }
        
        function showMessage(text) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.classList.remove('hidden');
            
            // Auto-hide after 4 seconds
            clearTimeout(window.messageTimer);
            window.messageTimer = setTimeout(() => {
                msg.classList.add('hidden');
            }, 4000);
        }
        
        // =========== QUEST-SPECIFIC INITIALIZATION ===========
        // Force voice loading
        if ('speechSynthesis' in window) {
            speechSynthesis.getVoices(); // Trigger loading
        }
        
        // Auto-start guide
        setTimeout(() => {
            if (!document.getElementById('loading').classList.contains('hidden')) {
                // Loading taking too long
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('controls').classList.remove('hidden');
                showMessage("VR Ready! Click telescope parts.");
            }
        }, 5000);
        
        // Keyboard shortcuts for testing
        document.addEventListener('keydown', function(e) {
            if (e.key === '1') explainPart('base');
            if (e.key === '2') explainPart('primary');
            if (e.key === '3') explainPart('eyepiece');
            if (e.key === ' ') speak("This is a Newtonian reflecting telescope");
            if (e.key === 'r') resetView();
        });
        
        // Auto-focus for Quest
        window.addEventListener('click', function() {
            // This helps with Quest interaction
            if (document.activeElement) {
                document.activeElement.blur();
            }
        });
        
    </script>
</body>
</html>